image: golang:latest

cache:
  key: ${GO}
  paths:
  - go/

stages:
    - get
    - test
    - build

get:
  stage: get
  script:
    - go mod tidy

test:
    stage: test
    script:
      - go vet ./...
      - go test ./...
      - go test -race ./...
      - go test -msan ./...

build:
    stage: build
    script:
      - go build -o cf-www
    artifacts:
      paths:
        - cf-www
